buildPack: python
pipelineConfig:
  env:
  - name: JENKINS_X_DOCKER_REGISTRY_SERVICE_HOST
    value: \"$DOCKER_REGISTRY\"
  - name: ORG
    value: trietlu 
  - name: JENKINS_X_DOCKER_REGISTRY_SERVICE_PORT
    value: "443"
  pipelines:
    pullRequest:
      build:
        preSteps:
        - sh: pip3 install python-taint && python3 -m pyt flask_app.py
          name: code-scan
      postBuild:
        preSteps:
        - sh: curl "https://awscli.amazonaws.com/awscli-exe-linux-x86_64.zip" -o "awscliv2.zip" && unzip awscliv2.zip && ./aws/install && wget -O jq https://github.com/stedolan/jq/releases/download/jq-1.6/jq-linux64 && chmod +x ./jq && aws ecr describe-image-scan-findings --repository-name trietlu/flask-jx-sample --image-id imageTag=$PREVIEW_VERSION --region us-east-2 --max-items 50 --page-size 50
    release:
      promote:
        preSteps:
        - sh: curl "https://awscli.amazonaws.com/awscli-exe-linux-x86_64.zip" -o "awscliv2.zip" && unzip awscliv2.zip && ./aws/install && wget -O jq https://github.com/stedolan/jq/releases/download/jq-1.6/jq-linux64 && chmod +x ./jq && aws ecr describe-image-scan-findings --repository-name trietlu/flask-jx-sample --image-id imageTag=$PREVIEW_VERSION --region us-east-2 --max-items 50 --page-size 50
          name: container-image-scan
